<!DOCTYPE html>
<html lang="en">
<head>
    <!-- 
        todo: 
            * Add some sort of cache or cookie to allow for temporary storage of the scratchpad
    
    -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
    
    <title>Scratch Pad</title>
    <script>
        $(document).ready(function(){
            let previous = document.referrer;
            if (previous.includes("toolBox.html")){
                $('#toolBox').show();
            }

            // if ($('.msg').length > 0){
            //     // $('.msg').append('<p style="text-align: right;"><a href="mailto:michael.dohse@imaginelearning.com">Michael.Dohse@imaginelearning.com</a></p>');
            //     $('.msg').append('<p style="text-align: right;"><a href="mailto:aaaabncggffyesoyicuhyz3u7u@imaginelearning.org.slack.com">Michael.Dohse@imaginelearning.com</a> &larr; Click to send a message to me in slack.</p>');
            // }

            var currentVal = $('select').val();
            $('#TextArea').css('background-color', currentVal);
            if(currentVal == '#242729' || currentVal == "#1f9fd1"){
                $('#TextArea').css('color', 'white');
            }else{
                $('#TextArea').css('color', 'black');
            }

            $('option').click(function(){
                var color = $(this).val();
                $('#TextArea').css('background-color', color);
                if (color == '#242729' || color == "#1f9fd1"){
                    $('#TextArea').css('color', 'white');
                }else{
                    $('#TextArea').css('color', 'black');
                }
                location.reload();
            });

            $('#TextArea').on('paste', function(){
                /*
                Possible regex for stripping html from the text
                cleanText = strInputCode.replace(/<\/?[^>]+(>|$)/g, ""); -- stack overflow

                The following is the beginning of the format detector
                Currently it only detects closing and self closing html tags
                Waiting for positive case test where Unicode is slipping by.
                So far I can not reproduce copying external formatting into the scratch pad
                I have confirmed that the text I was using did have formatting,
                    when I paste it into the scratch pad the formatting is removed
                    as previously expected, but I have had reports of formatting
                    still getting through. Isolated reports, but still. Not able to reproduce

                I am also on the fence on whether or not to strip the found html
                tags or stick with just alerting the user. There are cases where html tags maybe legit and not need to be removed. Maybe we just add a remove formatting button or something. Food for thought
                */
                setTimeout(function(){
                    let changed = false;
                    let foundHTML = false;
                    let text = $('#TextArea').val();

                    if (text.includes("/>") || text.includes("</")){
                        alert("HTML MARKERS HAVE BEEN DETECTED\n\nDOUBLE CHECK THE DOCUMENT FOR UNUSUAL FORMATTING");
                    }

                    let regtest = /\b[o]\b\s/gm;
                    if (text.match(regtest)){
                        text = text.replaceAll(regtest, '');
                        changed = true;
                    }

                    regtest = /[•§·]\s/gm;
                    if (text.match(regtest)){
                        text = text.replaceAll(regtest, '');
                        changed = true;
                    }

                    // changed = false;
                    if (changed){
                        $('#TextArea').val(text);
                    }
                }, 700);
            });

        });
    </script>
    <style>
        textarea {
            width: 100%;
            height:inherit;
        }
        select {
            max-width: 75px;
            margin-bottom: 5px;
        }
        .presentation {
            display: flex;
            justify-content: space-between;
        }
        .msg{
            width: 80%;
            border: 1px solid black;
            height: fit-content;
            padding: 0px 10px;
            font-size: .85em;
            background-color: lightgray;
            user-select: none;
        }
        .msgContainer {
            display: flex;
            justify-content: right;
            width: 50%;
        }
        #TextAreaContain {
            height: 85vh;
            width: 50%;
            display: flex;
            flex-direction: column;
        }
        @media (width > 1152px){
            textarea {
                width: 80%
            }
            .msg {
                width: 50%;
            }
        }
    </style>

</head>
<body>
    <h3 id="toolBox" style="text-align:right; display: none;"><a href="../toolBox.html">Back to ToolBox</a></h3>
    <div class="presentation">
        <div id="TextAreaContain">
            <select name="color" id="color">
                <option style="background-color: #242729;color: white;" value="#242729" selected>Dark</option>
                <option style="background-color: #33f753;color: black;" value="#33f753">Green</option>
                <option style="background-color: #1f9fd1;color: white;" value="#1f9fd1">Blue</option>
                <option value="white">White</option>
                <option style="background-color: #f2f224;color: black;" value="#f2f224">Yellow</option>
            </select>
            <textarea name="scratchPad" id="TextArea" max-width="40%" encoding="UTF-8" style="font-size: 14px;" autofocus></textarea>
        </div>
        <div class="msgContainer">
            <div class="msg">
                <h3>Update!</h3>
                <p>An alert should happen if HTML formatting is attached to the text pasted into the text area. For the moment this is just to alert you there are HTML indicators in the textarea, no HTML tags are being removed. If there are bullets from a list that get copied over, they should be removed automatically.</p>
                <p>If you do get the alert then take a look at what you just pasted and see if you find any HTML that shouldn't be there. If you get the alert but can't find anything let me know and I will assist.</p>
            </div>
        </div>
    </div>
</body>
</html>
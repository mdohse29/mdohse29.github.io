function space(e){for(a=0;a<e.length;a++)" "==e[a]&&(e=e.replace(" ","%20"));return e}function generateInput(e,t,n,l){let a=mkInp({type:"text",class:"control input",autocomplete:"off",id:e||"",placeholder:l||"",label:t?t+":&nbsp;":"",labelOpt:{class:"label is-inline-block"}});return nestElem([mkDiv({class:"field",title:n||""}),{1:a.label,2:a.input}])}function generateDropDown(e,t,n){let l=[{inner:"dla_tiletrial",value:"dla_tiletrial/js/tiletrial.js"},{inner:"dla_dragdrop",value:"dla_dragdrop/js/dragdrop.js"},{inner:"dla_tictactoe",value:"dla_tictactoe/js/tictactoe.js"},{inner:"dla_textboxl",value:"dla_textboxl/js/textboxl.js"},{inner:"dla_sbx",value:"dla_sbx/js/sbx.js"},{inner:"dla_speeddrill",value:"dla_speeddrill/js/speeddrill.js"},{inner:"dla_sorter",value:"dla_sorter/js/sorter.js"},{inner:"dla_slideshow",value:"dla_slideshow/js/dla_slideshow.js"},{inner:"dla_puzzlematch",value:"dla_puzzlematch/js/puzzlematch.js"},{inner:"dla_powerpopquiz",value:"dla_powerpopquiz/js/powerpopquiz.js"},{inner:"dla_popquiz",value:"dla_popquiz/js/popquiz.js"},{inner:"dla_metalsquares",value:"dla_metalsquares/js/dla_metalsquares.js"},{inner:"dla_holeymoley",value:"dla_holeymoley/js/holeymoley.js"},{inner:"dla_farmerfrank",value:"dla_farmerfrank/js/farmerfrank.js"},{inner:"dla_concentration",value:"dla_concentration/js/dla_concentration.js"},{inner:"dla_allright",value:"dla_allright/js/allright.js"},{inner:"dla_feedback",value:"dla_feedback/js/feedback.js"},{inner:"dla_conjugatorchart",value:"dla_conjugatorchart/js/conjugatorchart.js"},{inner:"dla_flashcards",value:"dla_flashcards/js/flashcards.js"},{inner:"dla_equationbuilder",value:"dla_equationbuilder/js/equation_builder.js"},{inner:"dla_whatcha_makin",value:"dla_whatcha_makin/js/watchmakin.js"},{inner:"dla_carnivalgame",value:"dla_carnivalgame/js/carnivalgame.js"},{inner:"periodic_table",value:"periodic_table/js/periodictable.js"},{inner:"dla_spellingbee",value:"dla_spellingbee/js/spellingbee.js"}];return l=l.sort(((e,t)=>e.value>t.value?1:-1)),nestElem([mkDiv({class:"field",title:n||""}),mkDiv({class:"select"}),{1:mkLabel({for:e,class:"label is-inline-block",inner:t+":&nbsp;"}),2:mkInp({type:"select",id:e,name:e,options:l})}])}function resetEverything(){let e=document.querySelector("#linkData"),t=document.querySelector("#linkBuild");document.querySelector("#preview")&&closePreview(),e.innerHTML="",e.classList.add("dnone"),t.getAttribute("class").includes("dnone")||(t.querySelector("p").remove(),t.classList.add("dnone")),document.querySelector("#selectMenu").classList.remove("dnone"),document.querySelector("#pffCheck").checked=!1,document.querySelector("#text").checked=!1,document.querySelector("#mediaType").value="DOC",document.querySelector("#showPreview").removeAttribute("disabled"),toggleExtras()}function submitData(){let e=document.querySelector("#linkBuild"),t=document.querySelector("#mediaType").value,n=document.createElement("p");n.classList.add("has-text-centered"),e.querySelector("p")&&e.querySelector("p").remove(),e.classList.remove("dnone"),"DOC"==t?mediaLink(n):"DLA"==t?dlaLink(n):"Animation"==t&&animationLink(n),n.innerHTML&&(n.classList.add("has-background-success-light"),e.appendChild(n))}function toggleExtras(){let e=document.querySelector("#mediaType").value;"DOC"==e?(document.querySelector("#pffCheck").parentElement.classList.add("dnone"),document.querySelector("#text").parentElement.classList.add("dnone")):"DLA"==e?(document.querySelector("#pffCheck").parentElement.classList.add("dnone"),document.querySelector("#text").parentElement.classList.remove("dnone")):(document.querySelector("#pffCheck").parentElement.classList.remove("dnone"),document.querySelector("#text").parentElement.classList.remove("dnone"))}function showPreview(){document.querySelector("#preview")&&closePreview();let e=document.querySelector("#linkBuild > p").innerText,t=nestElem([mkDiv({class:"column",id:"preview"}),mkDiv({class:"box"}),{1:mkBtn({class:"button close is-info is-outlined",title:"Close Preview",inner:"X"}),2:mkElem({elemType:"iframe",src:e})}]);document.querySelector(".container > .columns:last-child").appendChild(t),document.querySelector(".container > .columns:last-child > .column").classList.add("dnone"),document.querySelector(".close").addEventListener("click",closePreview)}function closePreview(){document.querySelector(".container > .columns:last-child > .column").classList.remove("dnone"),document.querySelector("#preview").remove()}function mediaSelect(){document.querySelector("#selectMenu").classList.add("dnone");let e=document.querySelector("#mediaType").value,t=document.querySelector("#linkData"),n=mkBtn({class:"button mt-4 is-rounded is-info",id:"submit",inner:"Generate URL"}),l=mkBtn({class:"button mt-4 is-rounded is-danger ml-3",id:"reset",inner:"Reset"});t.classList.remove("dnone"),l.addEventListener("click",resetEverything),n.addEventListener("click",submitData),"DOC"==e?(t.appendChild(generateInput("dataBasePath","Unit UUID","The UUID for the unit can be found in Cayman.")),t.appendChild(generateInput("fileName","File Name (incl file ext)","The file name for the file being linked to. Include the file extension (.jpg, .gif, .docx, etc.)"))):"DLA"==e?(t.appendChild(generateDropDown("source","Source Path")),document.querySelector("#source").addEventListener("input",(function(){this.value.includes("periodic_table")?document.querySelectorAll("#dataBasePath, #dlaFilename").forEach((e=>{e.setAttribute("disabled","disabled")})):document.querySelectorAll("#dataBasePath, #dlaFilename").forEach((e=>{e.removeAttribute("disabled")}))})),t.appendChild(generateInput("dataBasePath","Unit UUID","The UUID for the unit can be found in Cayman.")),t.appendChild(generateInput("dlaFilename","DLA File Name","The file name for the dla file on AWS. (incl. extension)","some_filename.dla"))):"Animation"==e&&(t.appendChild(generateInput("base","Base","If the animation is in the unit folder use the unit UUID. Otherwise use the base of the course code, for g_alg01_2016 you would enter alg01.")),t.appendChild(generateInput("sourcePath","Source Path","The same as the source in CAT media reference.")));let a=document.querySelector("#pffCheck").checked,r=document.querySelector("#text").checked;a&&("Animation"==e&&(document.querySelector("#base").addEventListener("input",(e=>{if(document.querySelector("#pffCheck").checked){let t=document.querySelector("#dataBasePath");e.target.value.length>=15&&e.target.value.includes("-")&&(t.value=e.target.value)}})),t.appendChild(generateInput("dataBasePath","Database Path (Unit UUID)","The UUID for the unit can be found in Cayman.","If different from Base"))),t.appendChild(generateInput("pffFile",".pff File Name","The file name fore the pff file, including the extension.","example.pff"))),r&&(t.appendChild(generateInput("topText","Top Text","Text to display above the media.")),t.appendChild(generateInput("bottomText","Bottom Text","Text to be displayed at the bottom of the media."))),t.appendChild(n),t.appendChild(l)}function animationLink(e){let t=document.querySelector("#base").value,n=document.querySelector("#sourcePath").value,l="",a="",r="",i="";e.innerText="https://cdn.lti.glynlyon.com/interactives/chm/cdn_harness/cdn_harness.html?base="+t+"&file="+n,document.querySelector("#pffCheck").checked&&(a=document.querySelector("#pffFile").value,a.includes(".pff")&&(a=a.replace(".pff","")),l=document.querySelector("#dataBasePath").value,!l&&t.length>15&&t.includes("-")&&(l=t),e.innerText+="&dataBasePath="+l+"&pff="+a),document.querySelector("#text").checked&&(r=document.querySelector("#topText").value,i=document.querySelector("#bottomText").value,r&&(e.innerText+="&topText="+space(r)),i&&(e.innerText+="&bottomText="+space(i)))}function mediaLink(e){let t="",n="",l=document.querySelector("#dataBasePath").value?document.querySelector("#dataBasePath").value:"null",a=document.querySelector("#fileName").value?document.querySelector("#fileName").value:"null",r=document.querySelector("#showPreview");"null"==a||"null"==l?(e.classList.add("has-background-danger"),r.setAttribute("disabled","disabled")):(t=a.substring(a.lastIndexOf(".")+1),r.removeAttribute("disabled")),n="mp4"==t||"webm"==t||"flv"==t?"video":"mp3"==t?"audio":"jpg"==t||"gif"==t||"png"==t?"img":"misc",e.innerHTML="https://cdn.lti.glynlyon.com/media/"+l+"/"+n+"/"+a}function dlaLink(e){let t=document.querySelector("#source").value,n=document.querySelector("#dataBasePath").value,l=document.querySelector("#dlaFilename").value;if(l&&!l.includes(".dla")&&(l+=".dla"),e.innerHTML="https://cdn.lti.glynlyon.com/interactives/chm/cdn_harness/cdn_harness.html?base=global&file="+t+(n?"&dataBasePath="+n:"")+(l?"&dlaFile="+l:""),document.querySelector("#pffCheck").checked){let t=document.querySelector("#pffFile").value;t&&(t.includes(".pff")||(t+=".pff"),e.innerHTML+="&pff="+t)}if(document.querySelector("#text").checked){let t=document.querySelector("#topText").value,n=document.querySelector("#bottomText").value;t&&(e.innerHTML+="&topText="+space(t)),n&&(e.innerHTML+="&bottomText="+space(n))}}resetEverything(),document.querySelector("#mediaselect").addEventListener("click",mediaSelect),document.querySelector("#showPreview").addEventListener("click",showPreview),document.querySelector("#mediaType").addEventListener("change",toggleExtras);